from typing import List


# tag: two_pointers, stack, greedy
class Solution:
    """
    https://leetcode.com/problems/shortest-unsorted-continuous-subarray/
    - ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ (`l` ì°¾ê¸°)
        - ë‹¨ì¡° ì¦ê°€ ìŠ¤íƒì„ ì‚¬ìš©í•˜ì—¬ ì •ë ¬ì´ ê¹¨ì§€ëŠ” ì²« ë²ˆì§¸ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŒ.
        - `nums[i]`ë³´ë‹¤ í° ê°’ì„ ë§Œë‚˜ë©´, í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ `pop()`í•˜ê³  `l`ì„ ìµœì†Œê°’ìœ¼ë¡œ ê°±ì‹ .
    - ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ (`u` ì°¾ê¸°)
        - ë‹¨ì¡° ê°ì†Œ ìŠ¤íƒì„ ì‚¬ìš©í•˜ì—¬ ì •ë ¬ì´ ê¹¨ì§€ëŠ” ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŒ.
        - `nums[i]`ë³´ë‹¤ ì‘ì€ ê°’ì„ ë§Œë‚˜ë©´, í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ `pop()`í•˜ê³  `u`ë¥¼ ìµœëŒ€ê°’ìœ¼ë¡œ ê°±ì‹ .
    - ì´ë¯¸ ì •ë ¬ëœ ê²½ìš° ì²´í¬
        - `l >= u`ì´ë©´ ì •ë ¬ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ `0` ë°˜í™˜.
        - ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `u - l + 1`ì„ ë°˜í™˜í•˜ì—¬ ì •ë ¬ì´ í•„ìš”í•œ ë¶€ë¶„ ë°°ì—´ì˜ ê¸¸ì´ë¥¼ ì¶œë ¥.
    """

    def findUnsortedSubarray(self, nums: List[int]) -> int:
        l, u = len(nums) - 1, 0
        stack = []

        # ğŸ”¹ (1) ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ íƒìƒ‰í•˜ì—¬ l ì°¾ê¸° (ë‹¨ì¡° ì¦ê°€ ìŠ¤íƒ)
        for i in range(len(nums)):
            while stack and nums[stack[-1]] > nums[i]:  # ì •ë ¬ì´ ê¹¨ì§€ëŠ” ì§€ì  ì°¾ê¸°
                l = min(l, stack.pop())  # ìµœì†Œ ì¸ë±ìŠ¤ ê°±ì‹ 
            stack.append(i)  # í˜„ì¬ ì¸ë±ìŠ¤ ì¶”ê°€

        stack = []

        # ğŸ”¹ (2) ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ íƒìƒ‰í•˜ì—¬ u ì°¾ê¸° (ë‹¨ì¡° ê°ì†Œ ìŠ¤íƒ)
        for i in range(len(nums) - 1, -1, -1):
            while stack and nums[stack[-1]] < nums[i]:  # ì •ë ¬ì´ ê¹¨ì§€ëŠ” ì§€ì  ì°¾ê¸°
                u = max(u, stack.pop())  # ìµœëŒ€ ì¸ë±ìŠ¤ ê°±ì‹ 
            stack.append(i)  # í˜„ì¬ ì¸ë±ìŠ¤ ì¶”ê°€

        # ğŸ”¹ (3) ì´ë¯¸ ì •ë ¬ëœ ê²½ìš° ì²´í¬
        return 0 if l >= u else u - l + 1
